"""Vulnerability detection patterns for static analysis"""

VULNERABILITY_PATTERNS = {
    "SQL Injection": {
        "pattern": r"(execute|cursor\.execute|query)\s*\(\s*['\"].*\%s.*['\"]|f['\"].*SELECT.*\{.*\}.*['\"]",
        "severity": "high",
        "description": "Direct string concatenation in SQL queries"
    },
    "Command Injection": {
        "pattern": r"(os\.system|subprocess\.call|subprocess\.run|eval)\s*\(\s*.*\+.*\)|exec\s*\(",
        "severity": "critical",
        "description": "Unsafe command execution with user input"
    },
    "Cross-Site Scripting (XSS)": {
        "pattern": r"innerHTML\s*=|document\.write\s*\(|\.html\s*\(",
        "severity": "high",
        "description": "Unsafe DOM manipulation that could allow XSS"
    },
    "Hardcoded Credentials": {
        "pattern": r"(password|secret|api_key|token)\s*=\s*['\"][^'\"]+['\"]",
        "severity": "critical",
        "description": "Hardcoded sensitive credentials in source code"
    },
    "Path Traversal": {
        "pattern": r"open\s*\(.*\+.*\)|File\s*\(.*\+.*\)",
        "severity": "high",
        "description": "Unsafe file path construction"
    },
    "Insecure Deserialization": {
        "pattern": r"pickle\.loads|yaml\.load\(|eval\s*\(|exec\s*\(",
        "severity": "critical",
        "description": "Unsafe deserialization of untrusted data"
    },
    "Weak Cryptography": {
        "pattern": r"md5|sha1|DES|RC4",
        "severity": "medium",
        "description": "Use of weak or deprecated cryptographic algorithms"
    },
    "Missing Authentication": {
        "pattern": r"@app\.route.*methods.*POST(?!.*@login_required)",
        "severity": "high",
        "description": "Endpoint without authentication decorator"
    },
     # SQL Injection (Java)
    "Java SQL Injection": {
        "pattern": r'Statement\s+\w+\s*=\s*conn\.createStatement\(\);\s*\w+\.executeQuery\s*\(\s*".*"\s*\+\s*\w+\s*\)',
        "severity": "high",
        "description": "Java: Direct string concatenation in SQL queries"
    },

    # Command Injection (Java)
    "Java Command Injection": {
        "pattern": r'Runtime\.getRuntime\(\)\.exec\s*\(\s*.*\+.*\)',
        "severity": "critical",
        "description": "Java: Unsafe command execution with user input"
    },

    # Cross-Site Scripting (XSS) (Java)
    "Java Cross-Site Scripting (XSS)": {
        "pattern": r'out\.print(?:ln)?\s*\(\s*.*\+.*\)|response\.getWriter\(\)\.write\s*\(\s*.*\+.*\)',
        "severity": "high",
        "description": "Java: Outputting unsanitized user input to HTML"
    },

    # Hardcoded Credentials (Java)
    "Java Hardcoded Credentials": {
        "pattern": r'(password|secret|apiKey|token)\s*=\s*".+"',
        "severity": "critical",
        "description": "Java: Hardcoded sensitive credentials in source code"
    },

    # Path Traversal (Java)
    "Java Path Traversal": {
        "pattern": r'new\s+File\s*\(\s*.*\+\s*\w+\s*\)',
        "severity": "high",
        "description": "Java: Unsafe file path construction"
    },

    # Insecure Deserialization (Java)
    "Java Insecure Deserialization": {
        "pattern": r'ObjectInputStream\s+\w+\s*=\s*new\s+ObjectInputStream\s*\(',
        "severity": "critical",
        "description": "Java: Unsafe deserialization of untrusted data"
    },

    # Weak Cryptography (Java)
    "Java Weak Cryptography": {
        "pattern": r'getInstance\s*\(\s*"(MD5|SHA1|DES|RC4)"\s*\)',
        "severity": "medium",
        "description": "Java: Use of weak or deprecated cryptographic algorithms"
    },

    # Missing Authentication (Java, e.g., Servlet without auth check)
    "Java Missing Authentication": {
        "pattern": r'doPost\s*\(.*HttpServletRequest.*HttpServletResponse.*\)\s*\{(?!.*request\.getSession\(\))',
        "severity": "high",
        "description": "Java: Servlet POST endpoint without authentication/session check"
    }
}
