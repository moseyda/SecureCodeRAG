import type { AnalysisResult } from "../types/analysis";
import { Search, AlertCircle, AlertTriangle, Info, CheckCircle, XCircle } from "lucide-react";
import ConfidenceBadge from "./ConfidenceBadge";
import styles from "./VulnerabilityList.module.css";

export default function VulnerabilityList({
  results
}: {
  results: AnalysisResult[];
}) {
  if (results.length === 0) return null;

  const getSeverityIcon = (severity: string) => {
    switch (severity?.toLowerCase()) {
      case "critical":
        return <XCircle size={20} className={styles.iconCritical} />;
      case "high":
        return <AlertCircle size={20} className={styles.iconHigh} />;
      case "medium":
        return <AlertTriangle size={20} className={styles.iconMedium} />;
      case "low":
        return <CheckCircle size={20} className={styles.iconLow} />;
      default:
        return <Info size={20} className={styles.iconInfo} />;
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <h2><Search size={20} /> Detected Vulnerabilities</h2>
        <span className={styles.badge}>{results.length} found</span>
      </div>

      <div className={styles.list}>
        {results
          .filter(r => r && r.type)
          .map((r, idx) => (
            <div key={idx} className={styles.item}>
              <div className={styles.itemHeader}>
                <div className={styles.titleSection}>
                  <span className={styles.icon}>
                    {getSeverityIcon(r.severity ?? "unknown")}
                  </span>
                  <div className={styles.titleContent}>
                    <h3 className={styles.title}>{r.type}</h3>
                    <p className={styles.cwe}>
                      {r.cwe && `CWE: ${r.cwe}`}
                      {r.owasp && ` â€¢ OWASP: ${r.owasp}`}
                    </p>
                  </div>
                </div>
                <div className={styles.badges}>
                  <span className={styles.line}>Line {r.line}</span>
                  <ConfidenceBadge confidence={r.confidence} />
                </div>
              </div>

              <div className={styles.snippet}>
                <code>{r.code}</code>
              </div>

              {r.category && (
                <div className={styles.category}>
                  Category: <strong>{r.category}</strong>
                </div>
              )}
            </div>
          ))}
      </div>
    </div>
  );
}